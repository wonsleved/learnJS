# Page: DOMContentLoaded, load, beforeunload, unload

The lifecycle of an HTML page has three important events:

- `DOMContentLoaded` – the browser fully loaded HTML, and the DOM tree is built, but external resources like pictures <img> and stylesheets may not yet have loaded. 
- `load` – not only HTML is loaded, but also all the external resources: images, styles etc. 
- `beforeunload/unload` – the user is leaving the page.

Each event may be useful:

- `DOMContentLoaded` event – DOM is ready. 
- `load` event – external resources are loaded, so styles are applied, image sizes are known etc. 
- `beforeunload` event – the user is leaving: we can check if the user saved the changes and ask them whether they really want to leave. 
- `unload` – the user almost left, but we still can initiate some operations, such as sending out statistics.

## DOMContentLoaded

The `DOMContentLoaded` event happens on the `document` object.

## DOMContentLoaded and scripts

***Scripts that don’t block DOMContentLoaded.***

1. Scripts with the `async` attribute.
2. Scripts that are generated dynamically with `document.createElement('script')` and then added to the webpage.

## DOMContentLoaded and styles

External style sheets don’t affect DOM, so `DOMContentLoaded` does not wait for them.

But if we have a script after the style, then that script must wait until the stylesheet loads.

## Built-in browser autofill

Firefox, Chrome and Opera autofill forms on `DOMContentLoaded`.

## window.onload

The load `event` on the `window` object triggers when the whole page is loaded including styles, images and other resources.

## window.onunload

When a visitor leaves the page, the `unload` event triggers on window. We can do something there that doesn’t involve a delay, like closing related popup windows.

`navigator.sendBeacon(url, data)` - It sends the data in background. The transition to another page is not delayed: the browser leaves the page, but still performs `sendBeacon`.

- The request is sent as POST. 
- We can send not only a string, but also forms and other formats, as described in the chapter Fetch, but usually it’s a stringified object. 
- The data is limited by 64kb.

There’s also a `keepalive` flag for doing such “after-page-left” requests in fetch method.

## window.onbeforeunload

If a visitor initiated navigation away from the page or tries to close the window, the `beforeunload` handler asks for additional confirmation.

```
window.onbeforeunload = function() {
  return false;
};
```

***The event.preventDefault() doesn’t work from a beforeunload handler.***

## readyState

The `document.readyState` property tells us about the current loading state.

There are 3 possible values:

- "loading" – the document is loading.
- "interactive" – the document was fully read.
- "complete" – the document was fully read and all resources (like images) are loaded too.

`readystatechange` event that triggers when the state changes.

- `document.readyState` becomes `interactive` right before `DOMContentLoaded`.
- `document.readyState` becomes complete when all resources are loaded.

We can use `img.onload`. 




